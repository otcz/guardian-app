<p-card class="strategy-card" *ngIf="!loading; else loadingTpl">
  <!-- Banner informativo si no existe estrategia cargada -->
  <div *ngIf="!strategy && !error && !success" class="info-banner">
    <i class="pi pi-info-circle"></i>
    <div class="info-text">
      <strong>No hay una estrategia vigente todavía.</strong>
      <span>
        Define los parámetros iniciales y pulsa <b>Guardar</b> para registrar la primera estrategia de gobernanza de esta organización.
        Puedes ajustar los switches para reflejar el nivel de autonomía y alcance deseado. Luego podrás actualizarla o crear nuevas versiones.
      </span>
    </div>
  </div>
  <!-- Formulario -->
  <form [formGroup]="form" (ngSubmit)="submit()" class="strategy-form">

    <div class="field-row cols-2">
      <div class="field">
        <label for="nombre">Nombre Estrategia</label>
        <select id="nombre" formControlName="nombre" (change)="adjustByNombre()">
          <option value="" disabled>Seleccione</option>
            <option *ngFor="let n of nombreOptions" [value]="n">{{ n }}</option>
        </select>
      </div>
      <div class="field">
        <label for="alcance">Alcance Ingresos</label>
        <select id="alcance" formControlName="alcance_ingresos">
          <option *ngFor="let a of alcanceOptions" [value]="a.value">{{ a.label }}</option>
        </select>
      </div>
    </div>

    <div class="field-row">
      <div class="field" style="grid-column:1 / -1;">
        <label for="descripcion">Descripción</label>
        <textarea id="descripcion" pTextarea rows="2" formControlName="descripcion"></textarea>
      </div>
    </div>

    <div class="toggle-grid">
      <div class="toggle-item" *ngFor="let field of [
          {key:'hereda_roles', label:'Hereda Roles'},
          {key:'crea_roles_locales', label:'Crea Roles Locales'},
          {key:'crea_parametros_locales', label:'Crea Parámetros Locales'},
          {key:'autonomia_menu_local', label:'Autonomía Menú Local'},
          {key:'crea_usuarios_en_seccion', label:'Crea Usuarios en Sección'},
          {key:'gestiona_vehiculos_locales', label:'Gestiona Vehículos Locales'},
          {key:'asigna_permisos_directos', label:'Asigna Permisos Directos'}
        ]">
        <input type="checkbox" class="ui-switch-input" [id]="field.key" [formControlName]="field.key" />
        <label class="ui-switch" [attr.for]="field.key"><span class="slider"></span></label>
        <label class="toggle-text" [for]="field.key">{{ field.label }}</label>
      </div>
      <div class="toggle-item">
        <input type="checkbox" class="ui-switch-input" id="activa" formControlName="activa" />
        <label class="ui-switch" for="activa"><span class="slider"></span></label>
        <label class="toggle-text" for="activa">Activa</label>
      </div>
    </div>

    <div class="actions">
      <button pButton type="submit" label="Guardar" [disabled]="saving || form.invalid" [icon]="saving ? 'pi pi-spin pi-spinner' : 'pi pi-save'"></button>
    </div>
  </form>
</p-card>

<ng-template #loadingTpl>
  <div class="actions" style="align-items:center;">
    <p-progressSpinner styleClass="w-2rem h-2rem" strokeWidth="4"></p-progressSpinner>
    <span>Cargando...</span>
  </div>
</ng-template>
