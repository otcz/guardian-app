<div class="org-toolbar" *ngIf="!error; else errorTpl">
  <button pButton type="button" icon="pi pi-arrow-left" class="p-button-text" label="Volver" (click)="back()"></button>
  <h2>Auditoría de Organización</h2>
  <span class="spacer"></span>
</div>

<div class="org-audit-wrapper" *ngIf="!error; else errorTpl">
  <p-card class="audit-card" *ngIf="!loading; else loadingTpl">
    <!-- Controles simplificados: solo refresh -->
    <div class="audit-tools simple-tools">
      <div class="flex ai-center w-100" style="justify-content:flex-end; gap:.5rem;">
        <button pButton type="button" icon="pi pi-refresh" label="Recargar" (click)="load()" [disabled]="loading"></button>
      </div>
    </div>

    <p-table [value]="filtered" [paginator]="true" [rows]="15" [rowsPerPageOptions]="[10,15,25,50]" styleClass="p-datatable-sm audit-table">
      <ng-template pTemplate="header">
        <tr>
          <th class="w-160">Fecha</th>
          <th class="w-110">Contexto</th>
          <th>Acción</th>
          <th>Detalle</th>
          <th class="w-120">Usuario</th>
          <th class="w-120">Sección</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-row>
        <tr>
          <td><span class="timestamp">{{ row.fecha_creacion | date:'yyyy-MM-dd HH:mm:ss' }}</span></td>
          <td><p-tag [value]="row.nivel_contexto || '-'" severity="info"></p-tag></td>
          <td>{{ row.accion }}</td>
          <td><span class="detalle">{{ row.detalle }}</span></td>
          <td><span class="fs-xs">{{ row.id_usuario || '-' }}</span></td>
          <td><span class="fs-xs">{{ row.id_seccion || '-' }}</span></td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr><td colspan="6" class="audit-empty">Sin registros</td></tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<ng-template #loadingTpl>
  <div class="flex flex-center" style="padding:2rem;">
    <p-progressSpinner></p-progressSpinner>
  </div>
</ng-template>

<ng-template #errorTpl>
  <p-card header="Error" class="audit-card">
    <div class="status-error">{{ error }}</div>
    <button pButton type="button" label="Volver" class="p-button-text" (click)="back()"></button>
  </p-card>
</ng-template>
