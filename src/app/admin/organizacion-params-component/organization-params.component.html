<div class="org-toolbar" *ngIf="!error; else errorTpl">
  <button pButton type="button" icon="pi pi-arrow-left" class="p-button-text" label="Volver" (click)="back()"></button>
  <h2>Parámetros Globales</h2>
  <span class="spacer"></span>
  <app-theme-toggle mode="cycle"></app-theme-toggle>
</div>

<div class="org-params-wrapper" *ngIf="!error; else errorTpl">
  <p-card class="params-card" *ngIf="org; else loadingOrgTpl">
    <div class="meta">
      <strong>{{ org.nombre }}</strong>
      <span>• Activa: <span [ngClass]="{'text-green': org.activa, 'text-red': !org.activa}">{{ org.activa? 'Sí':'No' }}</span></span>
    </div>

    <div class="param-layout">
      <!-- Listado -->
      <div class="param-list">
        <h4>Listado</h4>
        <table class="param-table">
          <thead>
            <tr>
              <th>Código</th>
              <th>Valor</th>
              <th style="text-align:center;">Activo</th>
              <th style="width:70px; text-align:center;">Acción</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of params; let i = index" [ngClass]="{'row-editing': editingIndex===i}">
              <td>{{ p.codigo }}</td>
              <td>{{ p.valor }}</td>
              <td style="text-align:center;">
                <span class="badge" [ngClass]="p.activo? 'b-green':'b-red'">{{ p.activo? 'Sí':'No' }}</span>
              </td>
              <td class="actions-inline">
                <button pButton type="button" icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-sm" (click)="edit(p,i)" title="Editar"></button>
                <button pButton type="button" icon="pi pi-trash" class="p-button-rounded p-button-text p-button-sm" (click)="remove(i)" title="Eliminar"></button>
              </td>
            </tr>
            <tr *ngIf="!params.length">
              <td colspan="4" class="audit-empty">Sin parámetros configurados</td>
            </tr>
          </tbody>
        </table>
        <div style="margin-top:.75rem;">
          <button pButton type="button" label="Nuevo" icon="pi pi-plus" (click)="newParam()"></button>
        </div>
      </div>

      <!-- Formulario -->
      <div class="param-form">
        <h4>{{ editingIndex!==null? 'Editar':'Agregar' }} Parámetro</h4>
        <form [formGroup]="form" (ngSubmit)="save()">
          <div>
            <label>Código *</label>
            <input pInputText formControlName="codigo" [readonly]="editingIndex!==null" />
          </div>
          <div>
            <label>Descripción</label>
            <input pInputText formControlName="descripcion" />
          </div>
          <div>
            <label>Valor *</label>
            <input pInputText formControlName="valor" />
          </div>
          <div class="switch-row">
            <label>Activo</label>
            <p-inputSwitch formControlName="activo"></p-inputSwitch>
          </div>
          <div class="actions-inline">
            <button pButton type="submit" label="Guardar" [disabled]="form.invalid"></button>
            <button pButton type="button" label="Limpiar" class="p-button-secondary" (click)="newParam()"></button>
          </div>
          <div class="messages">
            <div *ngIf="error" class="error">{{ error }}</div>
            <div *ngIf="success" class="success">{{ success }}</div>
          </div>
        </form>
      </div>
    </div>

    <div style="margin-top:1.25rem;">
      <button pButton type="button" label="Volver" class="p-button-text" (click)="back()"></button>
    </div>
  </p-card>
</div>

<ng-template #loadingOrgTpl>
  <div style="display:flex; justify-content:center; padding:2rem;">
    <p-progressSpinner></p-progressSpinner>
  </div>
</ng-template>

<ng-template #errorTpl>
  <p-card header="Error">
    <div class="messages error">{{ error }}</div>
    <button pButton type="button" label="Volver" class="p-button-text" (click)="back()"></button>
  </p-card>
</ng-template>
