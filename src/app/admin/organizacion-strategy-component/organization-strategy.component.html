<div class="org-toolbar">
  <button pButton type="button" icon="pi pi-arrow-left" class="p-button-text" label="Volver" (click)="back()"></button>
  <h2>Estrategia de Gobernanza</h2>
  <span class="spacer"></span>
</div>

<!-- Mensajes -->
<div class="status-messages" *ngIf="error || success">
  <span class="status-error" *ngIf="error">{{ error }}</span>
  <span class="status-success" *ngIf="success">{{ success }}</span>
</div>

<p-card class="strategy-card" *ngIf="!loading; else loadingTpl">
  <form [formGroup]="form" (ngSubmit)="submit()" class="strategy-form">

    <div class="field-row cols-2">
      <div class="field">
        <label for="nombre">Nombre Estrategia</label>
        <select id="nombre" formControlName="nombre" (change)="adjustByNombre()">
          <option value="" disabled>Seleccione</option>
            <option *ngFor="let n of nombreOptions" [value]="n">{{ n }}</option>
        </select>
      </div>
      <div class="field">
        <label for="alcance">Alcance Ingresos</label>
        <select id="alcance" formControlName="alcance_ingresos">
          <option *ngFor="let a of alcanceOptions" [value]="a.value">{{ a.label }}</option>
        </select>
      </div>
    </div>

    <div class="field-row">
      <div class="field" style="grid-column:1 / -1;">
        <label for="descripcion">Descripción</label>
        <textarea id="descripcion" pInputTextarea rows="2" formControlName="descripcion"></textarea>
      </div>
    </div>

    <div class="toggle-grid">
      <div class="toggle-item" *ngFor="let field of [
          {key:'hereda_roles', label:'Hereda Roles'},
          {key:'crea_roles_locales', label:'Crea Roles Locales'},
          {key:'crea_parametros_locales', label:'Crea Parámetros Locales'},
          {key:'autonomia_menu_local', label:'Autonomía Menú Local'},
          {key:'crea_usuarios_en_seccion', label:'Crea Usuarios en Sección'},
          {key:'gestiona_vehiculos_locales', label:'Gestiona Vehículos Locales'},
          {key:'asigna_permisos_directos', label:'Asigna Permisos Directos'}
        ]">
        <p-inputSwitch [inputId]="field.key" [formControlName]="field.key"></p-inputSwitch>
        <label [for]="field.key">{{ field.label }}</label>
      </div>
      <div class="toggle-item">
        <p-inputSwitch inputId="activa" formControlName="activa"></p-inputSwitch>
        <label for="activa">Activa</label>
      </div>
    </div>

    <div class="actions">
      <button pButton type="submit" label="Guardar" [disabled]="saving || form.invalid" [icon]="saving ? 'pi pi-spin pi-spinner' : 'pi pi-save'"></button>
      <button pButton type="button" label="Recargar" icon="pi pi-refresh" (click)="load()" [disabled]="saving"></button>
    </div>
  </form>
</p-card>

<ng-template #loadingTpl>
  <div class="actions" style="align-items:center;">
    <p-progressSpinner styleClass="w-2rem h-2rem" strokeWidth="4"></p-progressSpinner>
    <span>Cargando...</span>
  </div>
</ng-template>
