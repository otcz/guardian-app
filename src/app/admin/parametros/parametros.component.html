<div class="admin-grid">
  <!-- Sidebar izquierda: navegación -->
  <aside class="nav">
    <div class="section-title">Administración</div>
    <a routerLink="/dashboard"><i class="pi pi-home"></i><span>Inicio</span></a>
    <ng-container *ngIf="(menu$ | async) as opts">
      <a *ngFor="let opt of opts" [routerLink]="opt.path">
        <i class="mdi" [ngClass]="opt.icon"></i>
        <span>{{ opt.descripcion }}</span>
      </a>
    </ng-container>
  </aside>

  <!-- Contenido principal: listado -->
  <section class="card">
    <header style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
      <h2 style="margin:0;">Parámetros</h2>
      <div style="display:flex; gap:8px; align-items:center;">
        <button pButton type="button" class="p-button p-button-outlined" (click)="nuevo()"><i class="pi pi-plus"></i><span style="margin-left:8px;">Nuevo</span></button>
        <app-theme-toggle mode="cycle"></app-theme-toggle>
      </div>
    </header>
    <p class="muted" style="margin:0 0 12px 0;">Gestiona las definiciones de parámetros (Nombre, Descripción y Tipo).</p>

    <p-table [value]="(lista$ | async) || []" [tableStyle]="{ 'min-width': '680px' }" [paginator]="true" [rows]="10">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 60px; text-align:center;">#</th>
          <th style="width: 90px;">Org ID</th>
          <th style="width: 280px;">Nombre</th>
          <th>Descripción</th>
          <th style="width: 110px;">Tipo</th>
          <th style="width: 120px;">Por defecto</th>
          <th style="width: 120px; text-align:right;">Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-row let-i="rowIndex">
        <tr>
          <td style="text-align:center;">{{ i + 1 }}</td>
          <td>{{ row.orgId }}</td>
          <td><code>{{ row.nombre }}</code></td>
          <td>{{ row.descripcion }}</td>
          <td>{{ row.tipo === 'NUM' ? 'Número' : row.tipo === 'TEXT' ? 'Texto' : 'Lista' }}</td>
          <td>{{ row.porDefecto | yesNo }}</td>
          <td style="text-align:right; display:flex; justify-content:flex-end; gap:6px;">
            <button pButton type="button" class="p-button p-button-text" (click)="editar(row)"><i class="pi pi-pencil"></i></button>
            <button pButton type="button" class="p-button p-button-text danger" (click)="eliminar(row)"><i class="pi pi-trash"></i></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </section>
</div>

<!-- Panel lateral derecho: Formulario de edición/creación -->
<p-sidebar [visible]="panelAbierto()" position="right" [modal]="true" (onHide)="cerrarPanel()" styleClass="p-sidebar-sm">
  <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
    <h3 style="margin:0;">{{ editandoId() ? 'Editar parámetro' : 'Nuevo parámetro' }}</h3>
    <button pButton type="button" class="p-button p-button-text" (click)="cerrarPanel()"><i class="pi pi-times"></i></button>
  </div>
  <form [formGroup]="form" (ngSubmit)="guardar()" style="display:flex; flex-direction:column; gap:12px;">
    <div class="form-field">
      <label for="nombre">Nombre (MAYÚSCULAS y _)</label>
      <input id="nombre" pInputText appUppercase type="text" formControlName="nombre" placeholder="DURACION_TOKEN_INGRESO" />
    </div>
    <div class="form-field">
      <label for="descripcion">Descripción</label>
      <input id="descripcion" pInputText type="text" formControlName="descripcion" placeholder="Descripción" />
    </div>
    <div class="form-field">
      <label for="tipo">Tipo</label>
      <p-dropdown id="tipo" formControlName="tipo" [options]="tipos" optionLabel="label" optionValue="value"></p-dropdown>
    </div>

    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:4px;">
      <button pButton type="button" class="p-button p-button-outlined" (click)="cerrarPanel()">Cancelar</button>
      <button pButton type="submit" class="p-button p-button-primary" [disabled]="form.invalid">Guardar</button>
    </div>
  </form>
</p-sidebar>
