<div class="container">
  <p-card class="card user-card">
    <div class="user-hero">
      <p-avatar [label]="initial" shape="circle" size="large" [style]="{ background: 'linear-gradient(135deg, var(--primary), var(--secondary))', color: '#fff' }"></p-avatar>
      <div class="user-meta">
        <div class="title-row">
          <h2 class="title">Asignar usuario a sección</h2>
          <p-tag *ngIf="selectedUser" [value]="selectedUser.activo ? 'ACTIVO' : 'INACTIVO'" [severity]="selectedUser.activo ? 'success' : 'danger'"></p-tag>
        </div>
        <div class="chip-row" *ngIf="selectedUser">
          <p-chip icon="pi pi-id-card" [label]="selectedUser.username || '-'" class="pill"></p-chip>
          <p-chip *ngIf="selectedUser.nombreCompleto" icon="pi pi-user" [label]="selectedUser.nombreCompleto || ''" class="pill"></p-chip>
          <p-chip *ngIf="selectedUser.email" icon="pi pi-envelope" [label]="selectedUser.email || ''" class="pill"></p-chip>
        </div>
      </div>
      <div class="actions-toolbar">
        <button pButton type="button" icon="pi pi-arrow-left" class="p-button p-button-text" [routerLink]="['/gestion-de-usuarios/listar-usuarios']" pTooltip="Volver"></button>
      </div>
    </div>

    <div class="form-grid">
      <div class="field">
        <label>Usuario</label>
        <p-dropdown [options]="usuarios" optionLabel="username" optionValue="id" [(ngModel)]="usuarioId" name="usuarioId" placeholder="Seleccione usuario"></p-dropdown>
      </div>

      <div class="field">
        <label>Sección</label>
        <p-dropdown [options]="secciones" optionLabel="nombre" optionValue="id" [(ngModel)]="seccionId" name="seccionId" placeholder="Seleccione sección"></p-dropdown>
      </div>

      <!-- Organización destino para Administrador (solo SYSADMIN) -->
      <div class="field" *ngIf="isSysadmin">
        <label>Organización destino (Administrador)</label>
        <p-dropdown [options]="orgs" optionLabel="nombre" optionValue="id" [(ngModel)]="orgAdminTargetOrgId" name="orgAdminTargetOrgId" placeholder="Seleccione organización"></p-dropdown>
      </div>

      <div class="actions">
        <button pButton type="button" label="Asignar" icon="pi pi-check" (click)="assign()" [disabled]="saving || !usuarioId || !seccionId"></button>
        <button pButton type="button" label="Quitar sección" class="p-button p-button-outlined" icon="pi pi-times" (click)="remove()" [disabled]="saving || !usuarioId"></button>
        <!-- Asignar Administrador de Organización (solo SYSADMIN) -->
        <button *ngIf="isSysadmin" pButton type="button" label="Asignar como Administrador" class="p-button p-button-secondary" icon="pi pi-shield" (click)="assignAsOrgAdmin()" [disabled]="saving || !usuarioId || !orgAdminTargetOrgId" pTooltip="Otorga rol ORGADMIN y mueve al usuario a la organización seleccionada"></button>
      </div>
    </div>
  </p-card>
</div>
