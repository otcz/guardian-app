<div class="form-center-wrapper">
  <!-- Toast para notificaciones -->
  <p-toast></p-toast>
  <div class="editar-usuario-form-horizontal">
    <div *ngIf="usuarios.length > 0 && !usuario">
      <p-table #dt class="tabla-usuarios-prime" [value]="usuariosFiltrados" [paginator]="true" [rows]="10"
               [responsiveLayout]="'scroll'" [showCurrentPageReport]="true"
               currentPageReportTemplate="{first} - {last} de {totalRecords}" [rowsPerPageOptions]="[5,10,20]"
               [globalFilterFields]="['nombreCompleto','documentoTipo','documentoNumero','correo','rol','estado','casa','telefono']"
               [resizableColumns]="true" columnResizeMode="expand">
        <ng-template pTemplate="caption">
          <div class="p-input-icon-left search-bar-modern">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="onGlobalFilterInput($event, dt)" placeholder="Buscar en la tabla..."
                   class="p-inputtext-sm search-bar-input" />
          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr>
            <th class="td-contador">#</th>
            <th pSortableColumn="nombreCompleto" class="td-nombre">Nombre
              <p-sortIcon field="nombreCompleto"></p-sortIcon>
            </th>
            <th pSortableColumn="documentoTipo" class="td-corto">Tipo CC
              <p-sortIcon field="documentoTipo"></p-sortIcon>
            </th>
            <th pSortableColumn="documentoNumero">N° Doc
              <p-sortIcon field="documentoNumero"></p-sortIcon>
            </th>
            <th pSortableColumn="correo">Correo
              <p-sortIcon field="correo"></p-sortIcon>
            </th>
            <th pSortableColumn="rol">Rol
              <p-sortIcon field="rol"></p-sortIcon>
            </th>
            <th pSortableColumn="estado" class="td-estado">Estado
              <p-sortIcon field="estado"></p-sortIcon>
            </th>
            <th pSortableColumn="casa" class="td-casa">Casa
              <p-sortIcon field="casa"></p-sortIcon>
            </th>
            <th pSortableColumn="telefono">Teléfono
              <p-sortIcon field="telefono"></p-sortIcon>
            </th>
            <th class="td-acciones">Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-u let-rowIndex="rowIndex">
          <tr>
            <td class="td-contador">{{ (dt.first || 0) + rowIndex + 1 }}</td>
            <td class="td-nombre">{{ u.nombreCompleto }}</td>
            <td class="td-corto">{{ u.documentoTipo }}</td>
            <td>{{ u.documentoNumero }}</td>
            <td>{{ u.correo }}</td>
            <td>{{ u.rol }}</td>
            <td class="td-estado">{{ u.estado }}</td>
            <td class="td-casa">{{ u.casa }}</td>
            <td>{{ u.telefono }}</td>
            <td class="td-acciones">
              <button pButton type="button" icon="pi pi-eye" class="boton-accion boton-ver-minimal" pTooltip="Ver" tooltipPosition="top" (click)="verUsuario(u)"></button>
              <button pButton type="button" icon="pi pi-pencil" class="boton-accion boton-editar-minimal" pTooltip="Editar" tooltipPosition="top" (click)="editarUsuario(u)"></button>
              <button pButton type="button" icon="pi pi-trash" class="boton-accion boton-eliminar-minimal" pTooltip="Eliminar" tooltipPosition="top" (click)="eliminarUsuario(u)"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>

      <!-- Diálogo de confirmación para eliminar -->
      <p-dialog [(visible)]="displayConfirm" modal="true" [closable]="false" [style]="{width: '520px'}" header="Confirmar eliminación">
        <div class="confirm-dialog-body">
          <p>{{ confirmMessage }}</p>
        </div>
        <ng-template pTemplate="footer">
          <div class="confirm-actions" style="display:flex;gap:12px;justify-content:flex-end;align-items:center;">
            <button pButton type="button" label="Sí" class="p-button-success confirm-yes" (click)="onConfirmYes()"></button>
            <button pButton type="button" label="No" class="p-button-danger confirm-no" (click)="onConfirmNo()"></button>
            <button pButton type="button" label="Cancelar" class="p-button-secondary confirm-cancel" (click)="onCancel()"></button>
          </div>
        </ng-template>
      </p-dialog>

    </div>

    <!-- Formulario de edición inline -->
    <div *ngIf="usuario" class="editar-usuario-card-wrapper">
      <div class="editar-usuario-card">
        <h2>Editar usuario</h2>
        <form (ngSubmit)="saveChanges()" class="form-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:14px 18px;">
          <div class="form-row full" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;grid-column:1 / -1;">
            <label class="icon-label"><i class="pi pi-user"></i></label>
            <input pInputText type="text" [(ngModel)]="usuario.nombreCompleto" name="nombreCompleto" placeholder="Nombre completo" class="form-control"
                   style="padding:10px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;" />
          </div>

          <div class="form-row" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;">
            <label class="icon-label"><i class="pi pi-id-card"></i></label>
            <select [(ngModel)]="usuario.documentoTipo" name="documentoTipo" class="form-control select-control"
                    style="padding:9px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;">
              <option value="CC">CC</option>
              <option value="CE">CE</option>
              <option value="PAS">PAS</option>
            </select>
          </div>

          <div class="form-row" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;">
            <label class="icon-label"><i class="pi pi-id-badge"></i></label>
            <input pInputText type="text" [(ngModel)]="usuario.documentoNumero" name="documentoNumero" placeholder="Número de documento" class="form-control"
                   style="padding:10px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;" />
          </div>

          <div class="form-row full" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;grid-column:1 / -1;">
            <label class="icon-label"><i class="pi pi-envelope"></i></label>
            <input pInputText type="email" [(ngModel)]="usuario.correo" name="correo" placeholder="Correo" class="form-control"
                   style="padding:10px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;" />
          </div>

          <div class="form-row" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;">
            <label class="icon-label"><i class="pi pi-lock"></i></label>
            <input pInputText type="password" [(ngModel)]="usuario.password" name="password" placeholder="Contraseña" class="form-control"
                   style="padding:10px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;" />
          </div>

          <div class="form-row" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;">
            <label class="icon-label"><i class="pi pi-briefcase"></i></label>
            <select [(ngModel)]="usuario.rol" name="rol" class="form-control select-control"
                    style="padding:9px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;">
              <option value="ADMIN">ADMIN</option>
              <option value="USER">USER</option>
            </select>
          </div>

          <div class="form-row" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;">
            <label class="icon-label"><i class="pi pi-check"></i></label>
            <select [(ngModel)]="usuario.estado" name="estado" class="form-control select-control"
                    style="padding:9px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;">
              <option value="ACTIVO">ACTIVO</option>
              <option value="INACTIVO">INACTIVO</option>
            </select>
          </div>

          <div class="form-row" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;">
            <label class="icon-label"><i class="pi pi-home"></i></label>
            <input pInputText type="text" [(ngModel)]="usuario.casa" name="casa" placeholder="Casa" class="form-control"
                   style="padding:10px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;" />
          </div>

          <div class="form-row" style="display:grid;grid-template-columns:48px 1fr;align-items:center;gap:12px 14px;">
            <label class="icon-label"><i class="pi pi-phone"></i></label>
            <input pInputText type="text" [(ngModel)]="usuario.telefono" name="telefono" placeholder="Teléfono" class="form-control"
                   style="padding:10px 12px;border-radius:8px;border:1px solid #e6eef9;background:#fbfdff;color:#0f172a;width:100%;box-shadow:none;" />
          </div>

          <div class="form-actions" style="grid-column:1 / -1;display:flex;justify-content:center;gap:16px;margin-top:6px;">
            <button pButton type="submit" label="Guardar cambios" class="guardar-btn" style="background:linear-gradient(90deg,#4f8cff 20%,#23272f 100%);color:#fff;border:none;height:48px;border-radius:10px;"></button>
            <button pButton type="button" label="Cancelar" class="cancelar-btn" (click)="cancelEdit()" style="background:transparent;color:#374151;border:1px solid #e6edf8;height:44px;border-radius:10px;"></button>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>
