<div class="form-center-wrapper">
  <div class="editar-usuario-form-horizontal">
    <div class="buscar-usuario-wrapper">
      <form class="crear-usuario-form-grid buscar-usuario-form" (ngSubmit)="buscarVehiculo()">
        <div class="form-grid" style="margin-bottom:0;">
          <div class="input-group search-group" style="flex-direction: row; align-items: center; gap: 0;">
            <label for="busqueda" class="input-label search-label" style="margin-bottom:0;">Buscar vehículo</label>
            <div class="input-icon-wrapper" style="flex: 1; margin-right: 8px;">
              <i class="pi pi-search search-icon"></i>
              <input pInputText type="text" [(ngModel)]="busqueda" name="busqueda" id="busqueda"
                     placeholder="Placa del vehículo..." required/>
            </div>
            <button pButton type="submit" class="btn-crear buscar-btn" style="margin-left:0; min-width: 90px;">
              Buscar
            </button>
          </div>
        </div>
      </form>
      <div *ngIf="mensaje && !vehiculo" class="mensaje mensaje-error">{{ mensaje }}</div>
    </div>
    <form *ngIf="vehiculo" class="editar-usuario-form" (ngSubmit)="editarVehiculo()">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
        <button pButton type="button" (click)="irMostrarTabla()" icon="pi pi-car" label="Vehículos"
                class="p-button-primary p-button-sm volver-btn"></button>
      </div>
      <div class="form-grid">
        <div class="input-group">
          <label for="placa" class="input-label">Placa</label>
          <div class="input-icon-wrapper">
            <i class="pi pi-id-card"></i>
            <input id="placa" [(ngModel)]="vehiculo.placa" name="placa" required placeholder="Placa"
                   [ngClass]="{'campo-requerido': intentoGuardar && (!vehiculo.placa || vehiculo.placa.trim() === '')}">
          </div>
        </div>
        <div class="input-group">
          <label for="tipo" class="input-label">Tipo</label>
          <div class="input-icon-wrapper">
            <i class="pi pi-car"></i>
            <select id="tipo" [(ngModel)]="vehiculo.tipo" name="tipo" required
                    [ngClass]="{'campo-requerido': intentoGuardar && (!vehiculo.tipo || vehiculo.tipo.trim() === '')}">
              <option value="">Seleccione tipo</option>
              <option *ngFor="let t of tipos" [value]="t">{{ TipoVehiculoLabels[t] }}</option>
            </select>
          </div>
        </div>
        <div class="input-group">
          <label for="marca" class="input-label">Marca</label>
          <div class="input-icon-wrapper">
            <i class="pi pi-tag"></i>
            <input id="marca" [(ngModel)]="vehiculo.marca" name="marca" required placeholder="Marca"
                   [ngClass]="{'campo-requerido': intentoGuardar && (!vehiculo.marca || vehiculo.marca.trim() === '')}">
          </div>
        </div>
        <div class="input-group">
          <label for="modelo" class="input-label">Modelo</label>
          <div class="input-icon-wrapper">
            <i class="pi pi-calendar"></i>
            <input id="modelo" [(ngModel)]="vehiculo.modelo" name="modelo" required placeholder="Modelo"
                   [ngClass]="{'campo-requerido': intentoGuardar && (!vehiculo.modelo || vehiculo.modelo.trim() === '')}">
          </div>
        </div>
        <div class="input-group">
          <label for="color" class="input-label">Color</label>
          <div class="input-icon-wrapper">
            <i class="pi pi-palette"></i>
            <input id="color" [(ngModel)]="vehiculo.color" name="color" required placeholder="Color"
                   [ngClass]="{'campo-requerido': intentoGuardar && (!vehiculo.color || vehiculo.color.trim() === '')}">
          </div>
        </div>
        <div class="input-group">
          <label for="activo" class="input-label">Activo</label>
          <div class="input-icon-wrapper">
            <i class="pi pi-check"></i>
            <select id="activo" [(ngModel)]="vehiculo.activo" name="activo" required
                    [ngClass]="{'campo-requerido': intentoGuardar && (vehiculo.activo === undefined || vehiculo.activo === null || vehiculo.activo === '')}">
              <option [ngValue]="true">Sí</option>
              <option [ngValue]="false">No</option>
            </select>
          </div>
        </div>
        <div class="input-group">
          <label for="usuarioEntity" class="input-label">Usuario asignado</label>
          <div class="input-icon-wrapper">
            <i class="pi pi-user"></i>
            <p-dropdown
              [options]="usuarios"
              [(ngModel)]="vehiculo.usuario"
              name="usuarioEntity"
              optionLabel="nombreCompleto"
              [filter]="true"
              [showClear]="true"
              [ngClass]="{'campo-requerido': intentoGuardar && (!vehiculo.usuario?.id)}"
              placeholder="Seleccione o busque un usuario"
              [style]="{width: '100%'}"
              [ngModelOptions]="{standalone: true}"
              required>
              <ng-template let-u pTemplate="item">
                <div class="usuario-dropdown-option">
                  <span class="usuario-nombre">{{ u.nombreCompleto }}</span>
                  <span class="usuario-doc">CC: {{ u.documentoNumero }}</span>
                </div>
              </ng-template>
              <ng-template let-u pTemplate="selectedItem">
                <div class="usuario-dropdown-option">
                  <span class="usuario-nombre">{{ u?.nombreCompleto }}</span>
                  <span class="usuario-doc">CC: {{ u?.documentoNumero }}</span>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>
      </div>
      <button type="submit" class="guardar-btn">Guardar cambios</button>
      <div class="mensaje mensaje-error" *ngIf="mensaje">{{ mensaje }}</div>
      <div class="snackbar" *ngIf="snackbarVisible">{{ snackbarMensaje }}</div>
    </form>
    <div *ngIf="!vehiculo && !mensaje" class="mensaje mensaje-estado">Busca un vehículo por placa para editarlo.</div>
  </div>
</div>
